<!-- publish-ride.html -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Publish Ride</title>
  <link rel="stylesheet" href="publish-ride.css">
</head>
<body>
  <div class="publish-ride-container">
    <h2>Publish Ride</h2>
    <form id="publishRideForm">
      <div class="form-group">
        <div class="form-group">
          <label for="pickup">Pickup Location:</label>
          <select id="pickup" name="pickup" required>
            <option value="">Select Pickup Location</option>
            <!-- Options will be dynamically added here -->
          </select>
        </div>
  
        <div class="form-group">
          <label for="dropoff">Dropoff Location:</label>
          <select id="dropoff" name="dropoff" required>
            <option value="">Select Dropoff Location</option>
            <!-- Options will be dynamically added here -->
          </select>
        </div>
  

        <div class="form-group">
          <label for="seats">Number of Seats:</label>
          <input type="number" id="seats" name="seats" min="1" max="10" value="1" style="width: 50px;">
          <button type="button" class="increase-btn" onclick="increaseSeats()">+</button>
        </div>

      <div class="form-group">
        <label for="datetime">Date and Time:</label>
        <input type="datetime-local" id="datetime" name="datetime" required>
      </div>

      <button type="button" class="swap-btn" onclick="swapLocations()">Swap</button>

      <button type="button" class="publish-btn" onclick="publishRide()">Publish Ride</button>
    </form>
  </div>

  <script>
    function increaseSeats() {
      var seatsInput = document.getElementById("seats");
      var currentSeats = parseInt(seatsInput.value, 10);
      if (currentSeats < 10) {
        seatsInput.value = currentSeats + 1;
      }
    }

    async function fetchPlaces() {
      try {
        const response = await fetch('http://localhost:8080/places/getAllPlaces');
        const data = await response.json();

        if (response.ok) {
          const places = data.places;

          // Populate the dropdowns with fetched places
          populateDropdown('pickup', places);
          populateDropdown('dropoff', places);
        } else {
          console.error('Error fetching places:', data.message);
        }
      } catch (error) {
        console.error('Error fetching places:', error.message);
      }
    }

    // Function to populate a dropdown with options
    function populateDropdown(dropdownId, places) {
      const dropdown = document.getElementById(dropdownId);

      places.forEach(place => {
        const option = document.createElement('option');
        option.value = place.name; // Assuming your place object has a 'name' property
        option.textContent = place.name;
        dropdown.appendChild(option);
      });
    }

    // Call fetchPlaces on page load to populate the dropdowns
    document.addEventListener('DOMContentLoaded', fetchPlaces);

    function swapLocations() {
      var pickup = document.getElementById('pickup').value;
      var dropoff = document.getElementById('dropoff').value;

      document.getElementById('pickup').value = dropoff;
      document.getElementById('dropoff').value = pickup;
    }
    
    async function publishRide() {
      const pickup = document.getElementById("pickup").value;
      const dropoff = document.getElementById("dropoff").value;
      const seats = document.getElementById("seats").value;
      const datetime = document.getElementById("datetime").value;

      const rideData = {
        source: pickup,
        destination: dropoff,
        availableSeats: seats,
        departureTime: datetime,
      };

      try {
        const response = await fetch('http://localhost:8080/postRide', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,
          },
          body: JSON.stringify(rideData),
        });

        const data = await response.json();

        if (response.ok) {
          alert('Ride posted successfully!');
          // Optionally, redirect or perform additional actions after a successful post
        } else {
          console.error('Error posting ride:', data.message);
        }
      } catch (error) {
        console.error('Error posting ride:', error.message);
      }
    }
  </script>
</body>
</html>
